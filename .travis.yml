dist: bionic

go: "1.12"

services:
  - docker

before_install:
- go get github.com/russross/blackfriday
- go get github.com/CurtisLusmore/ghp
- docker pull butuzov/deadlinks:0.1.0

script:
  - ./tests.sh
  - tools/build
  - ghp -port 9090 -root public 1>/dev/null &
  - |
      docker run --rm -it --network=host butuzov/deadlinks:0.1.0 \
        localhost:9090 --fiff -n 10
deploy:
  provider: pages
  skip_cleanup: true
  github_token: $GITHUB_TOKEN
  local_dir: public
  on:
    branch: ukrainian


# Notifications settings.
notifications:
  email: false
  webhooks:
    urls:
      - https://fathomless-fjord-24024.herokuapp.com/notify
  slack:
    rooms:
      - made-ua:XGUkOpb0PsEuqmm0CvHaNfPk#builds
    template:
      - '*%{repository_slug}@%{branch}*<%{compare_url}|#%{commit}> (_%{author}_) - <%{build_url}|Travis CI: Build #%{build_number}>'
      - '*Title:* %{commit_message}'
      - '----------------------------------------------------------------------- '
      - '(`%{build_id}` is `%{result}`) _%{message}_ in `%{elapsed_time}`'
